# Index

- 数据卷

  - 挂载
  - volume 命令
  - 注意项

- 数据容器卷

# 数据卷

- 数据卷通过映射的方式实现了容器内与宿主机之间共享资源的需求，从而解决了容器内数据持久化的问题。
- 由于是共享资源，因此无论是在容器内还是宿主机上变动资源时，另一方可即时感知到；同时只占一份内存。

## 挂载

挂载数据卷分三种方式,同时可以拥有多个 -v 表示同时建立多个数据卷:

- 挂载路径：`docker run -v /宿主机路径:/容器路径[:rw|ro] IMAGE` 挂载路径指直接将宿主机路径作为容器卷，通过这种方式建立的数据卷无法通过 volumen 命令进行管理；

- 具名挂载: `docker run -v VOLUMENNAME:/容器路径[:rw|ro] IMAGE` 具名挂载由 docker 根据指定的名称自动生成数据卷，该类数据卷可以通过 volumen 命令进行管理；

- 匿名挂载: `docker run -v /容器路径[:rw|ro] IMAGE` 匿名挂载由 docker 自动生成全局唯一的数据卷名称以及数据卷，该类数据卷可以通过 volumen 命令进行管理；

`:rw|ro`: 表示容器内对于数据卷的权限，默认 rw 即读写权限，ro 只读。

## volumen 命令

- ls: 查看所有具名、匿名生成的数据卷；
- rm [-f] VOLUMEN: 删除指定的数据卷，不加 -f 选项时，不允许删除还在使用的数据卷（还在使用指依然有容器依赖该数据卷，无论容器是否处于启动状态）；
- prune: 删除所有不在使用的数据卷；
- inspect VOLUMEN: 查看数据元数据，例如挂载路径等；
- create: 创建数据卷，通常在容器运行时通过 -v 来设置数据卷，因此该命令不常用。

默认情况下，具名、匿名创建的数据卷存放于 /var/lib/docker/volumes 目录内。

## 覆盖规则

- 挂载路径：宿主机目录不存在时，建立数据卷时，保留容器内目录资源；宿主机目录存在时，建立数据卷时，不保留容器内目录资源，保留宿主机容器目录资源（宿主机目录为空时导致容器内目录为空）；
- 具名：与挂载路径相同，使用存在的数据卷名称建立数据卷时，使用数据卷内原有的资源，不保留容器内目录资源；
- 匿名: 匿名挂载本质上是自动建立新的目录以及数据卷，因此不存在覆盖问题。

# 数据卷容器

当一个容器挂载了数据卷后便称之为数据卷容器，数据卷容器可以被其他容器继承，从而实现共享数据卷。

`docker run --volume-from CONTAINER IMAGE`
