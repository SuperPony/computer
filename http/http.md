# HTTP 
该笔记主要记录 HTTP 基础特性以及大致结构。


# Index
- HTTP 特点
- 请求方法
- 持久连接
- Cookie
- HTTP 报文
- HTTP 报文首部


# HTTP 特点


- HTTP 协议用于客户端、服务端之间通信：HTTP 协议和 TCP/IP 协议族内的其他众多协议相同，用于客户端和服务器之间的通信；进行请求访问的一段称为客户端，而提供响应的则称之为服务端；
- 通过请求和响应的交换达成通信：HTTP 协议规定，请求由客户端发出，最后由服务端响应，故而可知，服务端在没有接收到请求前，不会发送响应；
- HTTP 是无状态协议： HTTP 协议自身并不对请求和响应之间的通信状态进行持久化保存（不保留之前一切请求或响应报文）；

# 请求方法

向指定 URI 方法请求报文时，采用被称为方法的命令；方法的作用在于告知请求的意图，从而使指定请求的资源按期望产生某种行为；另外需要注意的是，方法区分大小写，注意要使用大写字母。

主要方法如下：

- GET（获取资源）：GET 方法用于请求已被 URI 识别的资源；
- POST （传输实体主体）：虽然 GET 方法也可以传输实体主体，但一般不用 GET 进行传输，而是使用 POST 方法，虽然 POST 与 GET 相似，但在语义上， POST 多用于向服务器传输主体内容而并非获取主体内容；
- PUT（传输文件）：PUT 方法用于传输文件，就像 FTP 协议的文件上传一样，要在求请报文的主体内容中包含文件内容，然后保存到指定 URI 的位置。但由于 HTTP/1.1 的 PUT方法本身不带有验证机制，任何人都可以进行上传，存在安全隐患，故而一般 Web 网站不采用该方法，但在业务上进行验证或采用REST标准的 Web 网站，可能会放开 PUT 方法；
- HEAD（获得报文首部）： HEAD 方法和 GET 方法一样，只是不返回报文主体部分。用于确认 URI 的有效性及资源更新的日期时间等；
- DELETE（删除文件）：请求 URI 删除指定的资源，但是 HTTP/1.1 的 DELETE 方法本身和 PUT 方法一样不带验证机制，所以一般的 Web 网站也不使用 DELETE 方法。当配合业务的验证或遵守 REST 标准时有可能会开放使用。

- OPTIONS（询问支持的方法）：OPTIONS 方法用来查询针对请求 URI 指定的资源支持的方法；

- TRACE（追踪路径）：TRACE 方法是让 Web 服务器端将之前的请求通信环回给客户端的方法；发送请求时，在 Max-Forwards 首部字段中填入数值，每经过一个服 务器端就将该数字减 1，当数值刚好减到 0 时，就停止继续传输，最后接收到请求的服务器端则返回状态码 200 OK 的响应。 客户端通过 TRACE 方法可以查询发送出去的请求是怎样被加工修改 / 篡改的。这是因为，请求想要连接到源目标服务器可能会通过代理 中转，TRACE 方法就是用来确认连接过程中发生的一系列操作。 但是，TRACE 方法本来就不怎么常用，再加上它容易引发 XST（Cross-Site Tracing，跨站追踪）攻击，通常就更不会用到了；

- CONNECT（要求用隧道协议连接代理）：CONNECT 方法要求在与代理服务器通信时建立隧道，实现用隧道协 议进行 TCP 通信。主要使用 SSL（Secure Sockets Layer，安全套接 层）和 TLS（Transport Layer Security，传输层安全）协议把通信内容 加 密后经网络隧道传输， CONNECT 方法格式为`CONNECT 代理服务器名:端口号 HTTP版本`。

![](./assets/img/methods.jpg)


# 持久连接

在 HTTP 初始版本中，每进行一次 HTTP 通信，就要断开一次 TCP 连接；但是由于当年的通信数据量都是很小的文本传输，所以这种机制看起来问题不大，但随着现代互联网的发展，Web 中往往包含大量的图片等数据量很大的资源，这种每次请求都进行 TCP 连接、断开的模式便会造成很大的通信量开销；

![](./assets/img/no-keep-alive.jpg)

为了解决上述问题，HTTP/1.1 和一部分 HTTP/1.0 想出了持久连接（HTTP keep-alive）的方法，持久连接的特点是，**只要任意一端没有明确提出断开连接，则保持 TCP 连接状态**。

![](./assets/img/keep-alive.jpg)

从图中可以得知，持久连接旨在建立1次 TCP 连接后进行多次请求的响应和交互。

持久连接的好处在于：
1. 减少了 TCP 连接的重复建立和断开的额外开销，减轻了服务器的负载；
2. 减少开销的那部分时间，使 HTTP 请求和响应能够更早的结束，从而 Web 页面的显示速度也就相应提高。

注意：在 HTTP/1.1 中，所有的连接默认都是持久连接，但在 HTTP/1.0 内并 未标准化。虽然有一部分服务器通过非标准的手段实现了持久连接，但服务器端不一定能够支持持久连接。毫无疑问，除了服务器端，客户端也需要支持持久连接。

## 管线化

持久连接使得多数请求以管线化（pipelining）方式发送成为可能。从 前发送请求后需等待并收到响应，才能发送下一个请求。管线化技术出现后，不用等待响应亦可直接发送下一个请求。
例如：当请求一个包含 10 张图片的 HTML Web 时，与挨个连接相比，用持久丽娜姐可以让请求更快结束。而管线化技术则比持久连接还要快，请求数越多，时间优势越明显。

![](./assets/img/pipelining.jpg)


# Cookie
由于 HTTP 是无状态协议，但对于业务而言，状态则是必要的，故而引入了 Cookie 技术来解决 HTTP 无状态的特性。 Cookie 本质上是一段存储于客户端的数据，当请求或响应时，Cookie 技术通过在请求报文中写入 Cookie 信息来控制客户端的状态。

Cookie 会根据从服务端发送的响应报文内的一个叫 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。当下次客户端再往服务端发送请求时，客户端会自动在请求报文内加入 Cookie 值。

当服务端发现客户端发送过来的 Cookie 后，会检查究竟是从哪一个客户端发送过来的连接请求，然后对比服务器伤的记录，最后得到之前的状态信息。

![](./assets/img/cookie.jpg)


# HTTP 报文

用于 HTTP 协议交互的信息被称为 HTTP 报文。请求端（客户端）的 HTTP 报文叫做请求报文，响应端（服务器端）的叫做响应报文，HTTP 报文本身是由多行（用 CR+LF 作换行符）数据构成的字符串文本；

HTTP 报文大致可分为报文首部和报文主体（请求发送的数据）两块。两者由最初出现的空行（CR+LF）来划分。通常，并不一定要有报文主体。

![](./assets/img/baowen.jpg)

![](./assets/img/baoweninfo.jpg)


## 编码提升
HTTP 在传输数据时可以按照数据原貌直接传输，但也可以在传输过程中通过编码提升传输速率。通过在传输时编码，能有效地处理大量 的访问请求。但是，编码的操作需要计算机来完成，因此会消耗更多 的 CPU 等资源。

报文主体和实体主体的差异：
- 报文（message）：是 HTTP 通信中的基本单位，由8位组字节流（octet sequence，其中 octet 为 8 个比特）组成，通过 HTTP 通信传输；
- 实体（entity）：作为请求或响应的有效载荷数据（补充项）被传输，其内容由实体首部和实体主体组成。

HTTP 报文的主体用于传输请求或响应的实体主体。 通常，报文主体等于实体主体。只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。